const firebaseConfig={apiKey:"AIzaSyD2i8d1usAifaTvqkNzgylOLU2XDtakAUk",authDomain:"webcon-concerns.firebaseapp.com",databaseURL:"https://webcon-concerns-default-rtdb.firebaseio.com",projectId:"webcon-concerns",storageBucket:"webcon-concerns.firebasestorage.app",messagingSenderId:"416233156932",appId:"1:416233156932:web:78a1dfce6c61cf030f2711"};firebase.initializeApp(firebaseConfig);const db=firebase.database(),PASSWORD="Webconadmin",MAX_USERS=4,SESSION_ID="sess_"+Math.random().toString(36).slice(2),ALLOWED_EMAILS=["josramas@proweaver.email","darescandallo@proweaver.email","jomtabornal@proweaver.email","jhepanoncio@proweaver.email"];function login(){const emailInput=document.getElementById("email"),passwordInput=document.getElementById("password");if(!ALLOWED_EMAILS.includes(email))return void alert("Email not authorized");if(password!==PASSWORD)return void alert("Incorrect password");const sessionsRef=db.ref("sessions");sessionsRef.once("value",snap=>{if(Object.keys(snap.val()||{}).length>=4)return void alert("Maximum of 4 users already logged in.");const userRef=sessionsRef.child(SESSION_ID);userRef.set({email:email,joinedAt:Date.now()}),userRef.onDisconnect().remove(),sessionStorage.setItem("loggedIn","true"),sessionStorage.setItem("email",email),sessionStorage.setItem("sessionId",SESSION_ID),location.href="Main.html"})}document.getElementById("tablesContainer")&&"true"!==sessionStorage.getItem("loggedIn")&&location.replace("index.html");const presenceRef=db.ref("presence/"+SESSION_ID);sessionStorage.getItem("loggedIn")&&(presenceRef.set({email:sessionStorage.getItem("email"),onlineAt:Date.now()}),presenceRef.onDisconnect().remove()),db.ref("presence").on("value",snap=>{const users=snap.val()||{},list=document.getElementById("onlineUsers");list&&(list.innerHTML="",Object.values(users).forEach(u=>{const li=document.createElement("li");li.textContent=u.email,list.appendChild(li)}))});const CLOUD_DOC="devChecklists/default-checklist",STORAGE_KEY="devChecklistTables";let tableCount=0,cloudSaveTimer,localEditLock=!1;function saveTables(){if(localEditLock)return;const data=[];document.querySelectorAll(".table-wrapper").forEach(wrapper=>{const date=wrapper.querySelector("input[type=date]").value,rows=[];wrapper.querySelectorAll("tbody tr").forEach(tr=>{rows.push({checkboxes:[...tr.querySelectorAll("input[type=checkbox]")].map(cb=>cb.checked),comments:[...tr.querySelectorAll("textarea")].map(t=>t.value)})}),data.push({date:date,rows:rows})}),localStorage.setItem(STORAGE_KEY,JSON.stringify(data)),clearTimeout(cloudSaveTimer),cloudSaveTimer=setTimeout(()=>{db.ref(CLOUD_DOC).set({updatedAt:firebase.database.ServerValue.TIMESTAMP,updatedBy:sessionStorage.getItem("email"),tables:data})},600)}db.ref(CLOUD_DOC+"/tables").on("value",snap=>{const cloudTables=snap.val();if(!cloudTables)return;localEditLock=!0;const container=tablesContainer,wrappers=[...container.querySelectorAll(".table-wrapper")];cloudTables.forEach((t,i)=>{if(!wrappers[i])return void generateTable("tablesContainer",t);const rows=wrappers[i].querySelectorAll("tbody tr");t.rows.forEach((r,ri)=>{const tr=rows[ri];tr&&(tr.querySelectorAll("input[type=checkbox]").forEach((cb,ci)=>{cb.checked=r.checkboxes[ci]}),tr.querySelectorAll("textarea").forEach((ta,ci)=>{ta.value=r.comments[ci]}),updateErrorCount(tr))}),updateColumnTotals(wrappers[i].querySelector("table").id)}),localStorage.setItem(STORAGE_KEY,JSON.stringify(cloudTables)),tableCount=cloudTables.length,localEditLock=!1}),async function init(){if(!document.getElementById("tablesContainer"))return;const snap=await db.ref(CLOUD_DOC).get(),data=snap.exists()?snap.val().tables:[];tablesContainer.innerHTML="",tableCount=0,data.length?data.forEach(d=>generateTable("tablesContainer",d)):generateTable("tablesContainer")}();